<div class="container mt-4">
  <h1 class="text-center">Nova Reserva</h1>

  <% if flash[:alert] %>
    <div class="alert alert-danger"><%= flash[:alert] %></div>
  <% end %>

  <div class="card p-4 shadow">
    <%= form_with model: @reservation, local: true, data: { controller: "reservation" } do |f| %>
      
      <!-- Seleção de quadra -->
      <div class="mb-3">
        <% if params[:court_id].present? %>
          <%= f.hidden_field :court_id, 
              value: params[:court_id],
              data: { 
                reservation_target: "court",
                action: "change->reservation#onChange"
              } %>
          <p><strong>Quadra selecionada:</strong> <%= Court.find(params[:court_id]).name %></p>
        <% else %>
          <%= f.label :court_id, "Quadra", class: "form-label" %>
          <%= f.collection_select :court_id, 
              Court.all, 
              :id, 
              :name, 
              { prompt: "Selecione uma quadra" }, 
              { 
                class: "form-select", 
                data: { 
                  reservation_target: "court",
                  action: "change->reservation#onChange"
                }
              } %>
        <% end %>
      </div>

      <!-- Seleção de Data -->
      <div class="mb-3">
        <%= f.label :date, "Data da Reserva", class: "form-label" %>
        <%= f.date_field :date, 
            min: Date.today, 
            class: "form-control",
            required: true,
            data: { 
              reservation_target: "date",
              action: "change->reservation#onChange"
            } %>
      </div>

      <!-- Seleção de Horário -->
      <div class="mb-3">
        <%= f.label :time_slot, "Horário Disponível", class: "form-label" %>
        <%= f.select :time_slot,
            [],
            { prompt: "Selecione uma quadra e uma data primeiro" },
            { 
              class: "form-select",
              required: true,
              data: { 
                reservation_target: "slotSelect"
              }
            } %>
      </div>

      <div class="d-flex justify-content-between">
        <%= link_to "Cancelar", reservations_path, class: "btn btn-secondary" %>
        <%= f.submit "Criar Reserva", class: "btn btn-success" %>
      </div>
    <% end %>
  </div>
</div>
